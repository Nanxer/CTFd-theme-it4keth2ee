{% extends "base.html" %}

{% block content %}
  <!-- 赛博朋克排行榜头部 -->
  <div class="cyber-scoreboard-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="neon-glow">
            <i class="fas fa-trophy me-3"></i>
            {% trans %}排行榜{% endtrans %}
          </h1>
        </div>
      </div>
    </div>
  </div>

  <div class="container cyber-container">
    {% include "components/errors.html" %}

    <!-- 分数图表 -->
    <div id="score-graph" class="cyber-graph-container align-items-center" :class="{'d-flex': show, 'd-none': !show}" x-data="ScoreboardDetail" x-ref="scoregraph" @bracket-change.window="activeBracket=$event.detail; update();">
      <div class="col-md-12 text-center">
        <div class="cyber-loading">
          <i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
          <p class="mt-3 cyber-loading-text">{% trans %}Loading performance data...{% endtrans %}</p>
        </div>
      </div>
    </div>

    <!-- 排行榜主体 -->
    <div id="scoreboard" class="row cyber-scoreboard" x-data="ScoreboardList">
      <!-- 分组导航 -->
      <template x-if="brackets.length && standings.length">
        <div class="col-md-12 py-4">
          <div class="cyber-bracket-nav">
            <h4 class="cyber-section-title">
              <i class="fas fa-layer-group me-2"></i>
              {% trans %}Competition Groups{% endtrans %}
            </h4>
            <nav class="nav nav-pills cyber-pills">
              <button :class="{'nav-link cyber-pill': true, 'active': !activeBracket}" @click="activeBracket=null">
                <i class="fas fa-globe me-1"></i>
                {% trans %}All{% endtrans %}
              </button>
              <template x-for="bracket in brackets">
                <button :class="{'nav-link cyber-pill': true, 'active': activeBracket == bracket.id}" x-text="bracket.name" @click="activeBracket=bracket.id">
                  <i class="fas fa-users me-1"></i>
                </button>
              </template>
            </nav>
          </div>
        </div>
      </template>

      <!-- 排行榜表格 -->
      <div class="col-md-12" x-show="standings.length">
        <div class="cyber-table-container">
          <table class="table cyber-table align-middle">
            <thead class="cyber-table-header">
            <tr>
              <th style="width: 100px" class="text-center">
                <i class="fas fa-medal me-1"></i>
                排名
              </th>
              <th class="text-start ps-3">
                <i class="fas fa-user me-1"></i>
                {{ get_mode_as_word(capitalize=True) }}
              </th>
              <th style="width: 140px" class="text-center">
                <i class="fas fa-bolt me-1"></i>
                分数
              </th>
            </tr>
            </thead>

            <tbody class="cyber-table-body">
              <template x-for="(standing, index) in standings.filter(i => activeBracket ? i.bracket_id==activeBracket : true)">
                <tr :class="{'cyber-table-row': true, 'cyber-top-3': index < 3}">
                  <th scope="row" class="text-center cyber-rank">
                    <div class="d-flex align-items-center justify-content-center">
                      <template x-if="index === 0">
                        <i class="fas fa-crown text-warning"></i>
                      </template>
                      <template x-if="index === 1">
                        <i class="fas fa-medal text-secondary"></i>
                      </template>
                      <template x-if="index === 2">
                        <i class="fas fa-medal text-danger"></i>
                      </template>
                      <template x-if="index > 2">
                        <span class="cyber-rank-number" x-text="index + 1"></span>
                      </template>
                    </div>
                  </th>
                  <td class="text-start cyber-player-info">
                    <a :href="standing.account_url" class="cyber-player-link" x-text="standing.name"></a>
                    <template x-if="standing.bracket_name">
                      <span class="badge cyber-bracket-badge ms-2" x-text="standing.bracket_name"></span>
                    </template>
                  </td>
                  <td class="text-center cyber-score">
                    <span class="cyber-score-value" x-text="standing.score"></span>
                    <div class="cyber-score-bar">
                      <div class="cyber-score-progress" :style="{width: (standing.score / Math.max(...standings.map(s => s.score)) * 100) + '%'}"></div>
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 空状态 -->
      <div class="col-md-12" x-show="! standings.length">
        <div class="cyber-empty-state">
          <i class="fas fa-chart-bar fa-4x text-muted mb-3"></i>
          <h3 class="cyber-empty-title">{% trans %}Scoreboard is empty{% endtrans %}</h3>
          <p class="cyber-empty-text">{% trans %}Be the first to complete challenges and claim the top spot!{% endtrans %}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 赛博朋克装饰元素 -->
  <div class="cyber-decoration">
    <div class="cyber-pulse-dots"></div>
    <div class="cyber-data-stream"></div>
  </div>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/scoreboard.js") }}
  
  <script>
    // 赛博朋克排行榜特效
    document.addEventListener('DOMContentLoaded', function() {
      // 排行榜行悬停效果
      const tableRows = document.querySelectorAll('.cyber-table-row');
      tableRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
          this.style.transform = 'translateX(10px)';
          this.style.boxShadow = '0 0 20px rgba(0, 255, 255, 0.3)';
        });
        row.addEventListener('mouseleave', function() {
          this.style.transform = 'translateX(0)';
          this.style.boxShadow = 'none';
        });
      });

      // 实时数据更新效果
      const updateScores = () => {
        const scoreElements = document.querySelectorAll('.cyber-score-value');
        scoreElements.forEach(element => {
          const currentScore = parseInt(element.textContent);
          const newScore = currentScore + Math.floor(Math.random() * 10);
          if (newScore !== currentScore) {
            element.style.color = '#00ff88';
            setTimeout(() => {
              element.style.color = '';
            }, 1000);
          }
        });
      };

      // 每5秒模拟一次数据更新
      setInterval(updateScores, 5000);
    });
  </script>

  <style>
    /* 排行榜特定样式 */
    .cyber-scoreboard-header {
      background: linear-gradient(135deg, rgba(10, 10, 20, 0.9), rgba(26, 26, 46, 0.9));
      border-bottom: 2px solid #00ffff;
      padding: 3rem 0;
      margin-bottom: 2rem;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    }

    .cyber-title {
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: 3px;
      margin-bottom: 0.5rem;
    }

    .cyber-subtitle {
      color: #a0a0cc;
      font-size: 1.1rem;
      letter-spacing: 1px;
    }

    .cyber-stats {
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid #00ffff;
      border-radius: 5px;
      padding: 1rem;
      backdrop-filter: blur(10px);
    }

    .cyber-stat-item {
      text-align: center;
    }

    .cyber-stat-label {
      display: block;
      font-size: 0.9rem;
      color: #a0a0cc;
      margin-bottom: 0.25rem;
    }

    .cyber-stat-value {
      display: block;
      font-size: 2rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff;
    }

    .cyber-table-container {
      background: rgba(26, 26, 46, 0.8);
      border: 1px solid #00ffff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    }

    .cyber-table-header {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
      border-bottom: 2px solid #00ffff;
    }

    .cyber-table-header th {
      font-weight: 600;
      letter-spacing: 1px;
      padding: 1rem;
      color: #e0e0ff;
    }

    .cyber-table-body tr {
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(0, 255, 255, 0.1);
    }

    .cyber-table-body tr:last-child {
      border-bottom: none;
    }

    .cyber-table-body tr.cyber-top-3 {
      background: rgba(0, 255, 255, 0.05);
    }

    .cyber-table-body tr:hover {
      background: rgba(0, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .cyber-rank {
      font-weight: 700;
      min-width: 100px;
    }
    
    .cyber-rank-number {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--cyber-neon-cyan);
      text-shadow: 0 0 8px var(--cyber-neon-cyan);
    }
    
    .cyber-table {
      width: 100%;
      table-layout: fixed;
    }
    
    .cyber-table th:first-child,
    .cyber-table td:first-child {
      width: 100px;
    }
    
    .cyber-table th:last-child,
    .cyber-table td:last-child {
      width: 140px;
    }
    
    .cyber-table th:nth-child(2),
    .cyber-table td:nth-child(2) {
      width: auto;
    }
      font-size: 1.2rem;
    }

    .cyber-rank-number {
      display: inline-block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      background: rgba(0, 255, 255, 0.2);
      border-radius: 50%;
      text-align: center;
    }

    .cyber-player-link {
      font-weight: 600;
      letter-spacing: 1px;
      transition: all 0.3s ease;
    }

    .cyber-player-link:hover {
      color: #ff00ff !important;
      text-shadow: 0 0 10px #ff00ff;
    }

    .cyber-bracket-badge {
      background: linear-gradient(45deg, #9d00ff, #ff00ff);
      border: none;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }

    .cyber-score-value {
      font-weight: 700;
      font-size: 1.3rem;
      color: #00ff88;
      text-shadow: 0 0 5px #00ff88;
    }

    .cyber-score-bar {
      width: 80px;
      height: 4px;
      background: rgba(0, 255, 255, 0.2);
      border-radius: 2px;
      margin: 5px auto 0;
      overflow: hidden;
    }

    .cyber-score-progress {
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #00ff88);
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    .cyber-empty-state {
      text-align: center;
      padding: 4rem 2rem;
      background: rgba(26, 26, 46, 0.5);
      border: 2px dashed #00ffff;
      border-radius: 10px;
      margin: 2rem 0;
    }

    .cyber-empty-title {
      color: #a0a0cc;
      margin-bottom: 1rem;
    }

    .cyber-empty-text {
      color: #8080aa;
    }
  </style>
{% endblock %}
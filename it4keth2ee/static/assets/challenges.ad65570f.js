import{m as n,C as l,h as p,T as r,d as f,a as y}from"./index.8bd281d2.js";function c(e){let s=new DOMParser().parseFromString(e,"text/html");return s.querySelectorAll('a[href*="://"]').forEach(a=>{a.setAttribute("target","_blank")}),s.documentElement.outerHTML}window.Alpine=n;n.store("challenge",{data:{view:""}});n.data("Hint",()=>({id:null,html:null,async showHint(e){if(e.target.open){let t=await l.pages.challenge.loadHint(this.id);if(t.errors){e.target.open=!1,l._functions.challenge.displayUnlockError(t);return}let s=t.data;if(s.content)this.html=c(s.html);else if(await l.pages.challenge.displayUnlock(this.id)){let a=await l.pages.challenge.loadUnlock(this.id);if(a.success){let d=(await l.pages.challenge.loadHint(this.id)).data;this.html=c(d.html)}else e.target.open=!1,l._functions.challenge.displayUnlockError(a)}else e.target.open=!1}}}));n.data("Challenge",()=>({id:null,next_id:null,submission:"",tab:null,solves:[],submissions:[],solution:null,response:null,share_url:null,max_attempts:0,attempts:0,ratingValue:0,selectedRating:0,ratingReview:"",ratingSubmitted:!1,async init(){p()},getStyles(){let e={"modal-dialog":!0};try{switch(l.config.themeSettings.challenge_window_size){case"sm":e["modal-sm"]=!0;break;case"lg":e["modal-lg"]=!0;break;case"xl":e["modal-xl"]=!0;break;default:break}}catch(t){console.log("Error processing challenge_window_size"),console.log(t)}return e},async init(){p()},async showChallenge(){new r(this.$el).show()},async showSolves(){this.solves=await l.pages.challenge.loadSolves(this.id),this.solves.forEach(e=>(e.date=f(e.date).format("MMMM Do, h:mm:ss A"),e)),new r(this.$el).show()},async showSubmissions(){let e=await l.pages.users.userSubmissions("me",this.id);this.submissions=e.data,this.submissions.forEach(t=>(t.date=f(t.date).format("MMMM Do, h:mm:ss A"),t)),new r(this.$el).show()},getSolutionId(){return n.store("challenge").data.solution_id},async showSolution(){let e=this.getSolutionId();l._functions.challenge.displaySolution=t=>{this.solution=t.html,new r(this.$el).show()},await l.pages.challenge.displaySolution(e)},getNextId(){return n.store("challenge").data.next_id},async nextChallenge(){const e=document.querySelector("[x-ref='challengeWindow']");e.style.display="none",window.closeChallengeModal&&(document.removeEventListener("keydown",window.handleEscKey),e.removeEventListener("click",window.handleModalClick),window.closeButtons&&window.closeButtons.forEach(t=>{t.removeEventListener("click",window.closeChallengeModal)}),delete window.closeChallengeModal,delete window.handleEscKey,delete window.handleModalClick,delete window.closeButtons),n.nextTick(()=>{this.$dispatch("load-challenge",this.getNextId())})},async getShareUrl(){let e={type:"solve",challenge_id:this.id};const o=(await(await l.fetch("/api/v1/shares",{method:"POST",body:JSON.stringify(e)})).json()).data.url;this.share_url=o},copyShareUrl(){navigator.clipboard.writeText(this.share_url);let e=y.getOrCreateInstance(this.$el);e.enable(),e.show(),setTimeout(()=>{e.hide(),e.disable()},2e3)},async submitChallenge(){this.response=await l.pages.challenge.submitChallenge(this.id,this.submission),await this.renderSubmissionResponse()},async renderSubmissionResponse(){this.response.data.status==="correct"&&(this.submission=""),this.max_attempts>0&&this.response.data.status!="already_solved"&&this.response.data.status!="ratelimited"&&(this.attempts+=1),this.$dispatch("load-challenges")},async submitRating(){(await l.pages.challenge.submitRating(this.id,this.selectedRating,this.ratingReview)).value?(this.ratingValue=this.selectedRating,this.ratingSubmitted=!0):alert("Error submitting rating")}}));n.data("ChallengeBoard",()=>({loaded:!1,challenges:[],challenge:null,async init(){if(this.challenges=await l.pages.challenges.getChallenges(),this.loaded=!0,window.location.hash){let e=decodeURIComponent(window.location.hash.substring(1)),t=e.lastIndexOf("-");if(t>=0){let o=[e.slice(0,t),e.slice(t+1)][1];await this.loadChallenge(o)}}},getCategories(){const e=[];this.challenges.forEach(t=>{const{category:s}=t;e.includes(s)||e.push(s)});try{const t=l.config.themeSettings.challenge_category_order;if(t){const s=new Function(`return (${t})`);e.sort(s())}}catch(t){console.log("Error running challenge_category_order function"),console.log(t)}return e},getChallenges(e){let t=this.challenges;e!==null&&(t=this.challenges.filter(s=>s.category===e));try{const s=l.config.themeSettings.challenge_order;if(s){const o=new Function(`return (${s})`);t.sort(o())}}catch(s){console.log("Error running challenge_order function"),console.log(s)}return t},async loadChallenges(){this.challenges=await l.pages.challenges.getChallenges()},async loadChallenge(e){await l.pages.challenge.displayChallenge(e,t=>{t.data.view=c(t.data.view),n.store("challenge").data=t.data,n.nextTick(()=>{const s=document.querySelector("[x-ref='challengeWindow']");s.style.display="block",window.closeChallengeModal=function(){s.style.display="none",history.replaceState(null,null," "),document.removeEventListener("keydown",window.handleEscKey),s.removeEventListener("click",window.handleModalClick),window.closeButtons&&window.closeButtons.forEach(a=>{a.removeEventListener("click",window.closeChallengeModal)})},window.handleModalClick=function(a){a.target===s&&window.closeChallengeModal()},s.addEventListener("click",window.handleModalClick),window.handleEscKey=function(a){a.key==="Escape"&&window.closeChallengeModal()},document.addEventListener("keydown",window.handleEscKey);const o=()=>{const a=s.querySelectorAll('[data-bs-dismiss="modal"], .btn-close, .close, button[aria-label*="close"], button[title*="close"]');window.closeButtons=a,a.forEach(i=>{var h,g,u,w;i.removeAttribute("data-bs-dismiss"),(i.classList.contains("btn-close")||i.classList.contains("close")||((h=i.getAttribute("aria-label"))==null?void 0:h.toLowerCase().includes("close"))||((g=i.getAttribute("title"))==null?void 0:g.toLowerCase().includes("close"))||((u=i.textContent)==null?void 0:u.trim().toLowerCase())==="\xD7"||((w=i.textContent)==null?void 0:w.trim().toLowerCase())==="close")&&i.addEventListener("click",function(m){m.preventDefault(),m.stopPropagation(),window.closeChallengeModal()})})};o(),setTimeout(o,200),history.replaceState(null,null,`#${t.data.name}-${e}`)})})}}));n.start();

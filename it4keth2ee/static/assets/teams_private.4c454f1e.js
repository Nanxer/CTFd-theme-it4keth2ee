import{m as l,C as i,c as p}from"./index.8bd281d2.js";import{s as r,c as h}from"./clipboard.59b0cc48.js";import{g as f}from"./userscore.bf2bcba6.js";import{e as C}from"./index.1cf73b05.js";import"./echarts.128204f2.js";window.Alpine=l;window.CTFd=i;l.store("inviteToken","");l.data("TeamEditModal",()=>({success:null,error:null,initial:null,errors:[],init(){this.initial=r(this.$el.querySelector("form"))},async updateProfile(){let e=r(this.$el,this.initial,!0);e.fields=[];for(const a in e)if(a.match(/fields\[\d+\]/)){let s={},o=parseInt(a.slice(7,-1));s.field_id=o,s.value=e[a],e.fields.push(s),delete e[a]}let t=await i.pages.teams.updateTeamSettings(e);t.success?(this.success=!0,this.error=!1,setTimeout(()=>{this.success=null,this.error=null},3e3)):(this.success=!1,this.error=!0,Object.keys(t.errors).map(a=>{const s=t.errors[a];this.errors.push(s)}))}}));l.data("TeamCaptainModal",()=>({success:null,error:null,errors:[],async updateCaptain(){let e=r(this.$el,null,!0),t=await i.pages.teams.updateTeamSettings(e);t.success?window.location.reload():(this.success=!1,this.error=!0,Object.keys(t.errors).map(a=>{const s=t.errors[a];this.errors.push(s)}))}}));l.data("TeamInviteModal",()=>({copy(){h(this.$refs.link)}}));l.data("TeamDisbandModal",()=>({errors:[],async disbandTeam(){let e=await i.pages.teams.disbandTeam();e.success?window.location.reload():this.errors=e.errors[""]}}));l.data("CaptainMenu",()=>({captain:!1,editTeam(){const e=document.getElementById("team-edit-modal");e.style.display="block",this.setupModalCloseHandlers(e)},chooseCaptain(){const e=document.getElementById("team-captain-modal");e.style.display="block",this.setupModalCloseHandlers(e)},async inviteMembers(){const e=await i.pages.teams.getInviteToken();if(e.success){const t=e.data.code,a=`${window.location.origin}${i.config.urlRoot}/teams/invite?code=${t}`;document.querySelector("#team-invite-modal input[name=link]").value=a,this.$store.inviteToken=a;const s=document.getElementById("team-invite-modal");s.style.display="block",this.setupModalCloseHandlers(s)}else Object.keys(e.errors).map(t=>{const a=e.errors[t];alert(a)})},disbandTeam(){const e=document.getElementById("team-disband-modal");e.style.display="block",this.setupModalCloseHandlers(e)},setupModalCloseHandlers(e){const t=o=>{o.target===e&&this.closeModal(e)};e.addEventListener("click",t);const a=o=>{o.key==="Escape"&&this.closeModal(e)};document.addEventListener("keydown",a);const s=e.querySelectorAll('[data-bs-dismiss="modal"], .btn-close, .close, button[aria-label*="close"], button[title*="close"]');s.forEach(o=>{var n,c,d,u;o.removeAttribute("data-bs-dismiss"),(o.classList.contains("btn-close")||o.classList.contains("close")||((n=o.getAttribute("aria-label"))==null?void 0:n.toLowerCase().includes("close"))||((c=o.getAttribute("title"))==null?void 0:c.toLowerCase().includes("close"))||((d=o.textContent)==null?void 0:d.trim().toLowerCase())==="\xD7"||((u=o.textContent)==null?void 0:u.trim().toLowerCase())==="close")&&o.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),this.closeModal(e)})}),e._closeHandlers={modalClick:t,escKey:a,closeButtons:s}},closeModal(e){e.style.display="none",e._closeHandlers&&(e.removeEventListener("click",e._closeHandlers.modalClick),document.removeEventListener("keydown",e._closeHandlers.escKey),e._closeHandlers.closeButtons.forEach(t=>{t.removeEventListener("click",this.closeModal)}),delete e._closeHandlers)}}));l.data("TeamGraphs",()=>({solves:null,fails:null,awards:null,solveCount:0,failCount:0,awardCount:0,getSolvePercentage(){return(this.solveCount/(this.solveCount+this.failCount)*100).toFixed(2)},getFailPercentage(){return(this.failCount/(this.solveCount+this.failCount)*100).toFixed(2)},getCategoryBreakdown(){const e=[],t={};this.solves.data.map(s=>{e.push(s.challenge.category)}),e.forEach(s=>{s in t?t[s]+=1:t[s]=1});const a=[];for(const s in t)a.push({name:s,count:t[s],percent:t[s]/e.length*100,color:p(s)});return a},async init(){this.solves=await i.pages.teams.teamSolves("me"),this.fails=await i.pages.teams.teamFails("me"),this.awards=await i.pages.teams.teamAwards("me"),this.solveCount=this.solves.meta.count,this.failCount=this.fails.meta.count,this.awardCount=this.awards.meta.count;let e=window.teamScoreGraphChartOptions;C(this.$refs.scoregraph,f(i.team.id,i.team.name,this.solves.data,this.awards.data,e))}}));l.start();
